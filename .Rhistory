rownames_to_column(var="taxa") %>%
melt() %>%
magrittr::set_names(c("sample", "taxa", "relab"))
head(plotDF1)#just checking it worked
taxonomy.2 <- tax_table(physeq.f) %>%
as.data.frame() %>%
rownames_to_column(var="taxa")
head(taxonomy.2)#just checking it worked
head(plotDF1)#just checking it worked
plotDF1 <- left_join(plotDF1, taxonomy.2, by="taxa") %>% select(taxa, sample, relab, Class) #would need to update here too if you change it.
head(plotDF1)#just checking it worked
length(levels(factor(plotDF$Class)))
mycolors <- c("cornsilk2","darkgray","dimgray","gray0","lightpink","deeppink","deeppink3","red","red4","coral1","coral4","chocolate1","lightgoldenrodyellow","khaki","darkgoldenrod1","darkgoldenrod","chartreuse","darkolivegreen1","darkgreen","aquamarine","aquamarine3","aquamarine4","cyan","cornflowerblue","blue","midnightblue","darkslategray","darkslateblue","orchid1","blueviolet","magenta","darkorchid4","purple","darkmagenta","burlywood4")
names(mycolors)<-levels(factor(plotDF$Class))
mycolors
sampdata<-data.frame(sample_data(physeq.f))
metadata.2 <- sampdata %>%
rownames_to_column(var="sample")
metadata.2
plotDF1 <- left_join(plotDF1, metadata.2, by="sample")
head(plotDF1)#just checking it worked
length(levels(factor(plotDF1$Class)))
plotDF1$Class<-factor(plotDF1$Class)
plotDF1$sample<-factor(plotDF1$sample)
plotDF1$Site<-factor(plotDF1$Region)
ggplot(plotDF1, aes(x=plotDF1$sample, relab, fill=Class)) + geom_bar(stat="identity", position = "stack") + theme(axis.text.x = element_text(angle = 90,size = 10)) + scale_fill_manual(values = mycolors,limits = levels(plotDF$Class)) + theme(legend.text=element_text(size=7), legend.position = "bottom",text = element_text(size=5),strip.text= element_text(size=15))+ facet_grid(~Region,space="free_x",scales="free_x",drop=TRUE)+theme(legend.title = element_text(size = 3),legend.text = element_text(size = 4.5))
length(levels(factor(plotDF$Class)))
length(levels(factor(plotDF$Class)))
mycolors <- c("red","orange","lightgoldenrodyellow","green","blue","magenta","darkorchid4","black")
#mycolors <- c("cornsilk2","darkgray","dimgray","gray0","lightpink","deeppink","deeppink3","red","red4","coral1","coral4","chocolate1","lightgoldenrodyellow","khaki","darkgoldenrod1","darkgoldenrod","chartreuse","darkolivegreen1","darkgreen","aquamarine","aquamarine3","aquamarine4","cyan","cornflowerblue","blue","midnightblue","darkslategray","darkslateblue","orchid1","blueviolet","magenta","darkorchid4","purple","darkmagenta","burlywood4")
names(mycolors)<-levels(factor(plotDF$Class))
mycolors
sampdata<-data.frame(sample_data(physeq.f))
metadata.2 <- sampdata %>%
rownames_to_column(var="sample")
metadata.2
plotDF1 <- left_join(plotDF1, metadata.2, by="sample")
head(plotDF1)#just checking it worked
length(levels(factor(plotDF1$Class)))
plotDF1$Class<-factor(plotDF1$Class)
plotDF1$sample<-factor(plotDF1$sample)
plotDF1$Site<-factor(plotDF1$Region)
#physeq.f <- filter_taxa(ps, function(x) sum(x >= 100) > (0.01*length(x)), prune = TRUE) #filter out super small numbers
physeq.f
head(sample_data(physeq.f))#just checking it worked
head(tax_table(physeq.f))#just checking it worked
physeq.f.ra <- transform_sample_counts(physeq.f, function(x) x*100/sum(x))
physeq.f.ra.ord <- tax_glom(physeq.f.ra, "Class",NArm=FALSE)
propData <- as.data.frame((otu_table(physeq.f.ra.ord)))
plotDF1 <- propData %>%
rownames_to_column(var="taxa") %>%
melt() %>%
magrittr::set_names(c("sample", "taxa", "relab"))
head(plotDF1)#just checking it worked
taxonomy.2 <- tax_table(physeq.f) %>%
as.data.frame() %>%
rownames_to_column(var="taxa")
head(taxonomy.2)#just checking it worked
head(plotDF1)#just checking it worked
plotDF1 <- left_join(plotDF1, taxonomy.2, by="taxa") %>% select(taxa, sample, relab, Class) #would need to update here too if you change it.
head(plotDF1)#just checking it worked
length(levels(factor(plotDF$Class)))
mycolors <- c("red","orange","lightgoldenrodyellow","green","blue","magenta","darkorchid4","black")
#mycolors <- c("cornsilk2","darkgray","dimgray","gray0","lightpink","deeppink","deeppink3","red","red4","coral1","coral4","chocolate1","lightgoldenrodyellow","khaki","darkgoldenrod1","darkgoldenrod","chartreuse","darkolivegreen1","darkgreen","aquamarine","aquamarine3","aquamarine4","cyan","cornflowerblue","blue","midnightblue","darkslategray","darkslateblue","orchid1","blueviolet","magenta","darkorchid4","purple","darkmagenta","burlywood4")
names(mycolors)<-levels(factor(plotDF$Class))
mycolors
sampdata<-data.frame(sample_data(physeq.f))
metadata.2 <- sampdata %>%
rownames_to_column(var="sample")
metadata.2
plotDF1 <- left_join(plotDF1, metadata.2, by="sample")
head(plotDF1)#just checking it worked
length(levels(factor(plotDF1$Class)))
plotDF1$Class<-factor(plotDF1$Class)
plotDF1$sample<-factor(plotDF1$sample)
plotDF1$Site<-factor(plotDF1$Region)
ggplot(plotDF1, aes(x=plotDF1$sample, relab, fill=Class)) + geom_bar(stat="identity", position = "stack") + theme(axis.text.x = element_text(angle = 90,size = 10)) + scale_fill_manual(values = mycolors,limits = levels(plotDF$Class)) + theme(legend.text=element_text(size=7), legend.position = "bottom",text = element_text(size=5),strip.text= element_text(size=15))+ facet_grid(~Region,space="free_x",scales="free_x",drop=TRUE)+theme(legend.title = element_text(size = 3),legend.text = element_text(size = 4.5))
mycolors <- c("red","orange","goldenrodyellow","green","blue","magenta","darkorchid4","black")
#mycolors <- c("cornsilk2","darkgray","dimgray","gray0","lightpink","deeppink","deeppink3","red","red4","coral1","coral4","chocolate1","lightgoldenrodyellow","khaki","darkgoldenrod1","darkgoldenrod","chartreuse","darkolivegreen1","darkgreen","aquamarine","aquamarine3","aquamarine4","cyan","cornflowerblue","blue","midnightblue","darkslategray","darkslateblue","orchid1","blueviolet","magenta","darkorchid4","purple","darkmagenta","burlywood4")
names(mycolors)<-levels(factor(plotDF$Class))
mycolors
sampdata<-data.frame(sample_data(physeq.f))
metadata.2 <- sampdata %>%
rownames_to_column(var="sample")
metadata.2
plotDF1 <- left_join(plotDF1, metadata.2, by="sample")
head(plotDF1)#just checking it worked
length(levels(factor(plotDF1$Class)))
plotDF1$Class<-factor(plotDF1$Class)
plotDF1$sample<-factor(plotDF1$sample)
plotDF1$Site<-factor(plotDF1$Region)
ggplot(plotDF1, aes(x=plotDF1$sample, relab, fill=Class)) + geom_bar(stat="identity", position = "stack") + theme(axis.text.x = element_text(angle = 90,size = 10)) + scale_fill_manual(values = mycolors,limits = levels(plotDF$Class)) + theme(legend.text=element_text(size=7), legend.position = "bottom",text = element_text(size=5),strip.text= element_text(size=15))+ facet_grid(~Region,space="free_x",scales="free_x",drop=TRUE)+theme(legend.title = element_text(size = 3),legend.text = element_text(size = 4.5))
#physeq.f <- filter_taxa(ps, function(x) sum(x >= 100) > (0.01*length(x)), prune = TRUE) #filter out super small numbers
physeq.f
head(sample_data(physeq.f))#just checking it worked
head(tax_table(physeq.f))#just checking it worked
physeq.f.ra <- transform_sample_counts(physeq.f, function(x) x*100/sum(x))
physeq.f.ra.ord <- tax_glom(physeq.f.ra, "Class",NArm=FALSE)
propData <- as.data.frame((otu_table(physeq.f.ra.ord)))
plotDF1 <- propData %>%
rownames_to_column(var="taxa") %>%
melt() %>%
magrittr::set_names(c("sample", "taxa", "relab"))
head(plotDF1)#just checking it worked
taxonomy.2 <- tax_table(physeq.f) %>%
as.data.frame() %>%
rownames_to_column(var="taxa")
head(taxonomy.2)#just checking it worked
head(plotDF1)#just checking it worked
plotDF1 <- left_join(plotDF1, taxonomy.2, by="taxa") %>% select(taxa, sample, relab, Class) #would need to update here too if you change it.
head(plotDF1)#just checking it worked
length(levels(factor(plotDF$Class)))
mycolors <- c("red","orange","goldenrodyellow","green","blue","magenta","darkorchid4","black")
#mycolors <- c("cornsilk2","darkgray","dimgray","gray0","lightpink","deeppink","deeppink3","red","red4","coral1","coral4","chocolate1","lightgoldenrodyellow","khaki","darkgoldenrod1","darkgoldenrod","chartreuse","darkolivegreen1","darkgreen","aquamarine","aquamarine3","aquamarine4","cyan","cornflowerblue","blue","midnightblue","darkslategray","darkslateblue","orchid1","blueviolet","magenta","darkorchid4","purple","darkmagenta","burlywood4")
names(mycolors)<-levels(factor(plotDF$Class))
mycolors
sampdata<-data.frame(sample_data(physeq.f))
metadata.2 <- sampdata %>%
rownames_to_column(var="sample")
metadata.2
plotDF1 <- left_join(plotDF1, metadata.2, by="sample")
head(plotDF1)#just checking it worked
length(levels(factor(plotDF1$Class)))
plotDF1$Class<-factor(plotDF1$Class)
plotDF1$sample<-factor(plotDF1$sample)
plotDF1$Site<-factor(plotDF1$Region)
ggplot(plotDF1, aes(x=plotDF1$sample, relab, fill=Class)) + geom_bar(stat="identity", position = "stack") + theme(axis.text.x = element_text(angle = 90,size = 10)) + scale_fill_manual(values = mycolors,limits = levels(plotDF$Class)) + theme(legend.text=element_text(size=7), legend.position = "bottom",text = element_text(size=5),strip.text= element_text(size=15))+ facet_grid(~Region,space="free_x",scales="free_x",drop=TRUE)+theme(legend.title = element_text(size = 3),legend.text = element_text(size = 4.5))
#physeq.f <- filter_taxa(ps, function(x) sum(x >= 100) > (0.01*length(x)), prune = TRUE) #filter out super small numbers
physeq.f
head(sample_data(physeq.f))#just checking it worked
head(tax_table(physeq.f))#just checking it worked
physeq.f.ra <- transform_sample_counts(physeq.f, function(x) x*100/sum(x))
physeq.f.ra.ord <- tax_glom(physeq.f.ra, "Class",NArm=FALSE)
propData <- as.data.frame((otu_table(physeq.f.ra.ord)))
plotDF1 <- propData %>%
rownames_to_column(var="taxa") %>%
melt() %>%
magrittr::set_names(c("sample", "taxa", "relab"))
head(plotDF1)#just checking it worked
taxonomy.2 <- tax_table(physeq.f) %>%
as.data.frame() %>%
rownames_to_column(var="taxa")
head(taxonomy.2)#just checking it worked
head(plotDF1)#just checking it worked
plotDF1 <- left_join(plotDF1, taxonomy.2, by="taxa") %>% select(taxa, sample, relab, Class) #would need to update here too if you change it.
head(plotDF1)#just checking it worked
length(levels(factor(plotDF$Class)))
mycolors <- c("red","orange","yellow","green","blue","magenta","darkorchid4","black")
#mycolors <- c("cornsilk2","darkgray","dimgray","gray0","lightpink","deeppink","deeppink3","red","red4","coral1","coral4","chocolate1","lightgoldenrodyellow","khaki","darkgoldenrod1","darkgoldenrod","chartreuse","darkolivegreen1","darkgreen","aquamarine","aquamarine3","aquamarine4","cyan","cornflowerblue","blue","midnightblue","darkslategray","darkslateblue","orchid1","blueviolet","magenta","darkorchid4","purple","darkmagenta","burlywood4")
names(mycolors)<-levels(factor(plotDF$Class))
mycolors
sampdata<-data.frame(sample_data(physeq.f))
metadata.2 <- sampdata %>%
rownames_to_column(var="sample")
metadata.2
plotDF1 <- left_join(plotDF1, metadata.2, by="sample")
head(plotDF1)#just checking it worked
length(levels(factor(plotDF1$Class)))
plotDF1$Class<-factor(plotDF1$Class)
plotDF1$sample<-factor(plotDF1$sample)
plotDF1$Site<-factor(plotDF1$Region)
ggplot(plotDF1, aes(x=plotDF1$sample, relab, fill=Class)) + geom_bar(stat="identity", position = "stack") + theme(axis.text.x = element_text(angle = 90,size = 10)) + scale_fill_manual(values = mycolors,limits = levels(plotDF$Class)) + theme(legend.text=element_text(size=7), legend.position = "bottom",text = element_text(size=5),strip.text= element_text(size=15))+ facet_grid(~Region,space="free_x",scales="free_x",drop=TRUE)+theme(legend.title = element_text(size = 3),legend.text = element_text(size = 4.5))
physeq.f.ra <- transform_sample_counts(ps, function(x) x*100/sum(x))
p<-merge_samples(physeq.f.ra,"Region")
view(otu_table(p))
o<-otu_table(p)
rowSums(otu_table(physeq.f.ra))
propData <- as.data.frame(o)
t<-data.frame(cbind(levels(as.factor(sample_data(ps)$Aquarick))))
t <-cbind(t,propData$ASV_1,propData$ASV_2,propData$ASV_3,propData$ASV_4,propData$ASV_6)
physeq.f.ra <- transform_sample_counts(ps, function(x) x*100/sum(x))
p<-merge_samples(physeq.f.ra,"Region")
o<-otu_table(p)
rowSums(otu_table(physeq.f.ra))
propData <- as.data.frame(o)
t<-data.frame(cbind(levels(as.factor(sample_data(ps)$Region))))
t <-cbind(t,propData$ASV_1,propData$ASV_2,propData$ASV_3,propData$ASV_4,propData$ASV_6)
colnames(t)<-c("Aquarick","ASC_1","ASV_2","ASV_3","ASV_4","ASV_6")
pcm = melt(t, id = c("Aquarick")) #convert data frame from a "wide" format to a "long" format
xx = ggplot(pcm, aes(x = Aquarick, y = variable,fill=variable)) + geom_point(aes(size = as.numeric(value)), alpha = 0.75, shape = 21) +  scale_size_continuous(limits = c(0.000001, 100), range = c(.5,10), breaks = c(1,25,50,75)) +  labs( x= "", y = "", size = "Abundance", fill = "")  +  theme(legend.key=element_blank(), axis.text.x = element_text(colour = "black", size = 12, face = "bold", angle = 90, vjust = 0.3, hjust = 1), axis.text.y = element_text(colour = "black", face = "bold", size = 11), legend.text = element_text(size = 10, face ="bold", colour ="black"), legend.title = element_text(size = 12, face = "bold"), panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2), legend.position = "right") + scale_y_discrete(limits = rev(levels(pcm$variable)))
xx
physeq.f.ra <- transform_sample_counts(ps, function(x) x*100/sum(x))
p<-merge_samples(physeq.f.ra,"Region")
o<-otu_table(p)
rowSums(otu_table(physeq.f.ra))
propData <- as.data.frame(o)
t<-data.frame(cbind(levels(as.factor(sample_data(ps)$Region))))
t <-cbind(t,propData$ASV_1,propData$ASV_2,propData$ASV_3,propData$ASV_4,propData$ASV_6)
colnames(t)<-c("Aquarick","ASV_1","ASV_2","ASV_3","ASV_4","ASV_6")
pcm = melt(t, id = c("Aquarick")) #convert data frame from a "wide" format to a "long" format
xx = ggplot(pcm, aes(x = Aquarick, y = variable,fill=variable)) + geom_point(aes(size = as.numeric(value)), alpha = 0.75, shape = 21) +  scale_size_continuous(limits = c(0.000001, 100), range = c(.5,10), breaks = c(1,25,50,75)) +  labs( x= "", y = "", size = "Abundance", fill = "")  +  theme(legend.key=element_blank(), axis.text.x = element_text(colour = "black", size = 12, face = "bold", angle = 90, vjust = 0.3, hjust = 1), axis.text.y = element_text(colour = "black", face = "bold", size = 11), legend.text = element_text(size = 10, face ="bold", colour ="black"), legend.title = element_text(size = 12, face = "bold"), panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2), legend.position = "right") + scale_y_discrete(limits = rev(levels(pcm$variable)))
xx
physeq.f.ra <- transform_sample_counts(ps, function(x) x*100/sum(x))
p<-merge_samples(physeq.f.ra,"Region")
o<-otu_table(p)
rowSums(otu_table(physeq.f.ra))
propData <- as.data.frame(o)
t<-data.frame(cbind(levels(as.factor(sample_data(ps)$Region))))
t <-cbind(t,propData$ASV_2,propData$ASV_3,propData$ASV_4,propData$ASV_6)
colnames(t)<-c("Aquarick","ASV_2","ASV_3","ASV_4","ASV_6")
pcm = melt(t, id = c("Aquarick")) #convert data frame from a "wide" format to a "long" format
xx = ggplot(pcm, aes(x = Aquarick, y = variable,fill=variable)) + geom_point(aes(size = as.numeric(value)), alpha = 0.75, shape = 21) +  scale_size_continuous(limits = c(0.000001, 100), range = c(.5,10), breaks = c(1,25,50,75)) +  labs( x= "", y = "", size = "Abundance", fill = "")  +  theme(legend.key=element_blank(), axis.text.x = element_text(colour = "black", size = 12, face = "bold", angle = 90, vjust = 0.3, hjust = 1), axis.text.y = element_text(colour = "black", face = "bold", size = 11), legend.text = element_text(size = 10, face ="bold", colour ="black"), legend.title = element_text(size = 12, face = "bold"), panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2), legend.position = "right") + scale_y_discrete(limits = rev(levels(pcm$variable)))
xx
physeq.f.ra <- transform_sample_counts(ps, function(x) x*100/sum(x))
p<-merge_samples(physeq.f.ra,"Region")
o<-otu_table(p)
rowSums(otu_table(physeq.f.ra))
propData <- as.data.frame(o)
t<-data.frame(cbind(levels(as.factor(sample_data(ps)$Region))))
t <-cbind(t,propData$ASV_2,propData$ASV_3,propData$ASV_4,propData$ASV_6)
colnames(t)<-c("Region","ASV_2","ASV_3","ASV_4","ASV_6")
pcm = melt(t, id = c("Region")) #convert data frame from a "wide" format to a "long" format
xx = ggplot(pcm, aes(x = Region, y = variable,fill=variable)) + geom_point(aes(size = as.numeric(value)), alpha = 0.75, shape = 21) +  scale_size_continuous(limits = c(0.000001, 100), range = c(.5,10), breaks = c(1,25,50,75)) +  labs( x= "", y = "", size = "Abundance", fill = "Region")  +  theme(legend.key=element_blank(), axis.text.x = element_text(colour = "black", size = 12, face = "bold", angle = 90, vjust = 0.3, hjust = 1), axis.text.y = element_text(colour = "black", face = "bold", size = 11), legend.text = element_text(size = 10, face ="bold", colour ="black"), legend.title = element_text(size = 12, face = "bold"), panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2), legend.position = "right") + scale_y_discrete(limits = rev(levels(pcm$variable)))
xx
physeq.f.ra <- transform_sample_counts(ps, function(x) x*100/sum(x))
p<-merge_samples(physeq.f.ra,"Region")
o<-otu_table(p)
rowSums(otu_table(physeq.f.ra))
propData <- as.data.frame(o)
t<-data.frame(cbind(levels(as.factor(sample_data(ps)$Region))))
t <-cbind(t,propData$ASV_2,propData$ASV_3,propData$ASV_4)
colnames(t)<-c("Region","ASV_2","ASV_3","ASV_4")
pcm = melt(t, id = c("Region")) #convert data frame from a "wide" format to a "long" format
xx = ggplot(pcm, aes(x = Region, y = variable,fill=variable)) + geom_point(aes(size = as.numeric(value)), alpha = 0.75, shape = 21) +  scale_size_continuous(limits = c(0.000001, 100), range = c(.5,10), breaks = c(1,25,50,75)) +  labs( x= "", y = "", size = "Abundance", fill = "Region")  +  theme(legend.key=element_blank(), axis.text.x = element_text(colour = "black", size = 12, face = "bold", angle = 90, vjust = 0.3, hjust = 1), axis.text.y = element_text(colour = "black", face = "bold", size = 11), legend.text = element_text(size = 10, face ="bold", colour ="black"), legend.title = element_text(size = 12, face = "bold"), panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2), legend.position = "right") + scale_y_discrete(limits = rev(levels(pcm$variable)))
xx
physeq.f <- filter_taxa(ps, function(x) sum(x >= 100) > (0.01*length(x)), prune = TRUE) #filter out super small numbers
physeq.f #check it worked
head(sample_data(physeq.f)) #just checking it worked
head(tax_table(physeq.f)) #just checking it worked
physeq.f.ra <- transform_sample_counts(physeq.f, function(x) x*100/sum(x)) #transform data from raw abundance to relative abundance
physeq.f.ra.ord <- tax_glom(physeq.f.ra, "Class",NArm=FALSE) #merge taxa on the class level, so that there's only 1 value for each Class CHANGE HERE IF YOU WANT A DIFFERENT TAXONOMIC LEVEL
propData <- as.data.frame((otu_table(physeq.f.ra.ord))) #make otu table a dataframe
plotDF1 <- propData %>% #within the propData variable
rownames_to_column(var="taxa") %>%
melt() %>%
magrittr::set_names(c("sample", "taxa", "relab"))
head(plotDF1)#just checking it worked
taxonomy.2 <- tax_table(physeq.f) %>%
as.data.frame() %>%
rownames_to_column(var="taxa")
head(taxonomy.2)#just checking it worked
head(plotDF1)#just checking it worked
plotDF1 <- left_join(plotDF1, taxonomy.2, by="taxa") %>% select(taxa, sample, relab, Class) #combine dataframes merging by taxa, ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
head(plotDF1)#just checking it worked
length(levels(factor(plotDF$Class))) #check how many classes there are
mycolors <- c("black","red","orange","yellow","green","blue","magenta","darkorchid4") #make a list of colors the same length as the number of classes
names(mycolors)<-levels(factor(plotDF$Class)) #set the colors to an associated taxonomic rank
mycolors
sampdata<-data.frame(sample_data(physeq.f))
metadata.2 <- sampdata %>%
rownames_to_column(var="sample")
metadata.2
plotDF1 <- left_join(plotDF1, metadata.2, by="sample")
head(plotDF1)#just checking it worked
length(levels(factor(plotDF1$Class)))
plotDF1$Class<-factor(plotDF1$Class)
plotDF1$sample<-factor(plotDF1$sample)
plotDF1$Site<-factor(plotDF1$Region)
ggplot(plotDF1, aes(x=plotDF1$sample, relab, fill=Class)) + geom_bar(stat="identity", position = "stack") + theme(axis.text.x = element_text(angle = 90,size = 10)) + scale_fill_manual(values = mycolors,limits = levels(plotDF$Class)) + theme(legend.text=element_text(size=7), legend.position = "bottom",text = element_text(size=5),strip.text= element_text(size=15))+ facet_grid(~Region,space="free_x",scales="free_x",drop=TRUE)+theme(legend.title = element_text(size = 3),legend.text = element_text(size = 4.5))
physeq.f <- filter_taxa(ps, function(x) sum(x >= 100) > (0.01*length(x)), prune = TRUE) #filter out super small numbers
physeq.f #check it worked
head(sample_data(physeq.f)) #just checking it worked
head(tax_table(physeq.f)) #just checking it worked
physeq.f.ra <- transform_sample_counts(physeq.f, function(x) x*100/sum(x)) #transform data from raw abundance to relative abundance
physeq.f.ra.ord <- tax_glom(physeq.f.ra, "Class",NArm=FALSE) #merge taxa on the class level, so that there's only 1 value for each Class CHANGE HERE IF YOU WANT A DIFFERENT TAXONOMIC LEVEL
propData <- as.data.frame((otu_table(physeq.f.ra.ord))) #make otu table a dataframe
plotDF1 <- propData %>% #within the propData variable
rownames_to_column(var="taxa") %>%
melt() %>%
magrittr::set_names(c("sample", "taxa", "relab"))
head(plotDF1)#just checking it worked
taxonomy.2 <- tax_table(physeq.f) %>%
as.data.frame() %>%
rownames_to_column(var="taxa")
head(taxonomy.2)#just checking it worked
head(plotDF1)#just checking it worked
plotDF1 <- left_join(plotDF1, taxonomy.2, by="taxa") %>% select(taxa, sample, relab, Class) #combine dataframes merging by taxa, with the columns listed in select. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
head(plotDF1)#just checking it worked
length(levels(factor(plotDF$Class))) #check how many classes there are
mycolors <- c("black","red","orange","yellow","green","blue","magenta","darkorchid4") #make a list of colors the same length as the number of classes
names(mycolors)<-levels(factor(plotDF$Class)) #set the colors to an associated taxonomic rank. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
mycolors #confirm it worked
sampdata<-data.frame(sample_data(physeq.f)) #make dataframe of the sample data
metadata.2 <- sampdata %>%
rownames_to_column(var="sample")
metadata.2
plotDF1 <- left_join(plotDF1, metadata.2, by="sample") #combine plotDF1 and metadata.2 by sample name
head(plotDF1) #just checking it worked
length(levels(factor(plotDF1$Class))) #check how many classes there are
plotDF1$Class<-factor(plotDF1$Class) #make class a factor
plotDF1$sample<-factor(plotDF1$sample) #make sample a factor
plotDF1$Site<-factor(plotDF1$Region) #make Region a factor
ggplot(plotDF1, aes(x=plotDF1$sample, relab, fill=Class)) +
geom_bar(stat="identity", position = "stack") +
theme(axis.text.x = element_text(angle = 90,size = 10)) +
scale_fill_manual(values = mycolors,limits = levels(plotDF$Class)) +
theme(legend.text=element_text(size=7), legend.position = "bottom",text = element_text(size=5),strip.text= element_text(size=15)) +
facet_grid(~Region,space="free_x",scales="free_x",drop=TRUE) +
theme(legend.title = element_text(size = 8),legend.text = element_text(size = 6))
physeq.f <- filter_taxa(ps, function(x) sum(x >= 100) > (0.01*length(x)), prune = TRUE) #filter out super small numbers
physeq.f #check it worked
head(sample_data(physeq.f)) #just checking it worked
head(tax_table(physeq.f)) #just checking it worked
physeq.f.ra <- transform_sample_counts(physeq.f, function(x) x*100/sum(x)) #transform data from raw abundance to relative abundance
physeq.f.ra.ord <- tax_glom(physeq.f.ra, "Class",NArm=FALSE) #merge taxa on the class level, so that there's only 1 value for each Class CHANGE HERE IF YOU WANT A DIFFERENT TAXONOMIC LEVEL
propData <- as.data.frame((otu_table(physeq.f.ra.ord))) #make otu table a dataframe
plotDF1 <- propData %>% #within the propData variable
rownames_to_column(var="taxa") %>%
melt() %>%
magrittr::set_names(c("sample", "taxa", "relab"))
head(plotDF1)#just checking it worked
taxonomy.2 <- tax_table(physeq.f) %>%
as.data.frame() %>%
rownames_to_column(var="taxa")
head(taxonomy.2)#just checking it worked
head(plotDF1)#just checking it worked
plotDF1 <- left_join(plotDF1, taxonomy.2, by="taxa") %>% select(taxa, sample, relab, Class) #combine dataframes merging by taxa, with the columns listed in select. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
head(plotDF1)#just checking it worked
length(levels(factor(plotDF$Class))) #check how many classes there are
mycolors <- c("black","red","orange","yellow","green","blue","magenta","darkorchid4") #make a list of colors the same length as the number of classes
names(mycolors)<-levels(factor(plotDF$Class)) #set the colors to an associated taxonomic rank. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
mycolors #confirm it worked
sampdata<-data.frame(sample_data(physeq.f)) #make dataframe of the sample data
metadata.2 <- sampdata %>%
rownames_to_column(var="sample")
metadata.2
plotDF1 <- left_join(plotDF1, metadata.2, by="sample") #combine plotDF1 and metadata.2 by sample name
head(plotDF1) #just checking it worked
length(levels(factor(plotDF1$Class))) #check how many classes there are. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
plotDF1$Class<-factor(plotDF1$Class) #make class a factor. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
plotDF1$sample<-factor(plotDF1$sample) #make sample a factor
plotDF1$Site<-factor(plotDF1$Region) #make Region a factor
ggplot(plotDF1, aes(x=plotDF1$sample, relab, fill=Class)) + #make a plot with genotype/sample name on the x-axis, relative abundance on the y-axis, and color filled by Class. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
geom_bar(stat="identity", position = "stack") + #make it a barplot with classes stacked on top of each other
theme(axis.text.x = element_text(angle = 90,size = 10)) + #set x-axis labels to be oriented vertically, and set the size of the text to 10
scale_fill_manual(values = mycolors,limits = levels(plotDF$Class)) + #set the colors being filled in by class to the mycolors variable made earlier
#theme(legend.text=element_text(size=7), legend.position = "bottom",text = element_text(size=5),strip.text= element_text(size=15)) + #set legend text size, position the legend
facet_grid(~Region,space="free_x",scales="free_x",drop=TRUE) + #facet wrap (separate out) by Region
theme(legend.title = element_text(size = 8),legend.text = element_text(size = 6)) #set legent title size to 8 and legend text size to 6
physeq.f <- filter_taxa(ps, function(x) sum(x >= 100) > (0.01*length(x)), prune = TRUE) #filter out super small numbers
physeq.f #check it worked
head(sample_data(physeq.f)) #just checking it worked
head(tax_table(physeq.f)) #just checking it worked
physeq.f.ra <- transform_sample_counts(physeq.f, function(x) x*100/sum(x)) #transform data from raw abundance to relative abundance
physeq.f.ra.ord <- tax_glom(physeq.f.ra, "Class",NArm=FALSE) #merge taxa on the class level, so that there's only 1 value for each Class CHANGE HERE IF YOU WANT A DIFFERENT TAXONOMIC LEVEL
propData <- as.data.frame((otu_table(physeq.f.ra.ord))) #make otu table a dataframe
plotDF1 <- propData %>% #within the propData variable
rownames_to_column(var="taxa") %>%
melt() %>%
magrittr::set_names(c("sample", "taxa", "relab"))
head(plotDF1)#just checking it worked
taxonomy.2 <- tax_table(physeq.f) %>%
as.data.frame() %>%
rownames_to_column(var="taxa")
head(taxonomy.2)#just checking it worked
head(plotDF1)#just checking it worked
plotDF1 <- left_join(plotDF1, taxonomy.2, by="taxa") %>% select(taxa, sample, relab, Class) #combine dataframes merging by taxa, with the columns listed in select. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
head(plotDF1)#just checking it worked
length(levels(factor(plotDF$Class))) #check how many classes there are
mycolors <- c("black","red","orange","yellow","green","blue","magenta","darkorchid4") #make a list of colors the same length as the number of classes
names(mycolors)<-levels(factor(plotDF$Class)) #set the colors to an associated taxonomic rank. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
mycolors #confirm it worked
sampdata<-data.frame(sample_data(physeq.f)) #make dataframe of the sample data
metadata.2 <- sampdata %>%
rownames_to_column(var="sample")
metadata.2
plotDF1 <- left_join(plotDF1, metadata.2, by="sample") #combine plotDF1 and metadata.2 by sample name
head(plotDF1) #just checking it worked
length(levels(factor(plotDF1$Class))) #check how many classes there are. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
plotDF1$Class<-factor(plotDF1$Class) #make class a factor. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
plotDF1$sample<-factor(plotDF1$sample) #make sample a factor
plotDF1$Site<-factor(plotDF1$Region) #make Region a factor
ggplot(plotDF1, aes(x=plotDF1$sample, relab, fill=Class)) + #make a plot with genotype/sample name on the x-axis, relative abundance on the y-axis, and color filled by Class. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
geom_bar(stat="identity", position = "stack") + #make it a barplot with classes stacked on top of each other
theme(axis.text.x = element_text(angle = 90,size = 10)) + #set x-axis labels to be oriented vertically, and set the size of the text to 10
scale_fill_manual(values = mycolors,limits = levels(plotDF$Class)) + #set the colors being filled in by class to the mycolors variable made earlier
#theme(legend.text=element_text(size=7), legend.position = "bottom",text = element_text(size=5),strip.text= element_text(size=15)) + #set legend text size, position the legend
facet_grid(~Region,space="free_x",scales="free_x",drop=TRUE) + #facet wrap (separate out) by Region
theme(legend.title = element_text(size = 8),legend.text = element_text(size = 6),legend.position = "bottom") #set legent title size to 8 and legend text size to 6
physeq.f.ra <- transform_sample_counts(ps, function(x) x*100/sum(x)) #switch to relative abundance from raw abundance
p<-merge_samples(physeq.f.ra,"Region") #merge by region
o<-otu_table(p) #make variable of p's otu table
rowSums(otu_table(physeq.f.ra)) #confirm that all of the rows add up to 100 (this makes sure that the data is actually in relative abundance format)
propData <- as.data.frame(o) #make otu table a dataframe
t<-data.frame(cbind(levels(as.factor(sample_data(ps)$Region)))) #make dataframe with region
t <-cbind(t,propData$ASV_2,propData$ASV_3,propData$ASV_4) #add the abundance data of the 3 ASVs from the simper to the dataframe
colnames(t)<-c("Region","ASV_2","ASV_3","ASV_4") #set the column names
pcm = melt(t, id = c("Region")) #convert data frame from a "wide" format to a "long" format
xx = ggplot(pcm, aes(x = Region, y = variable,fill=variable)) + #make plot with Region as the x-axis, the significant ASVs as the y-axis, and color filled by the significant ASVs
geom_point(aes(size = as.numeric(value)), alpha = 0.75, shape = 21) +  #make bubble plot format where the size of the bubble is the relative abundance
scale_size_continuous(limits = c(0.000001, 100), range = c(.5,10), breaks = c(1,25,50,75)) + #set bubble size scaling
labs( x= "", y = "", size = "Abundance", fill = "Significant ASVs")  + #set labels for size legend and color legend
theme(legend.key=element_blank(), axis.text.x = element_text(colour = "black", size = 12, face = "bold", angle = 90, vjust = 0.3, hjust = 1), axis.text.y = element_text(colour = "black", face = "bold", size = 11), legend.text = element_text(size = 10, face ="bold", colour ="black"), legend.title = element_text(size = 12, face = "bold"), panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, size = 1.2), legend.position = "right") + #set various text sizes and colors, as well as legend position
scale_y_discrete(limits = rev(levels(pcm$variable))) #set y-scale limits to significant ASVs
xx #print plot
physeq.f <- filter_taxa(ps, function(x) sum(x >= 100) > (0.01*length(x)), prune = TRUE) #filter out super small numbers
physeq.f #check it worked
head(sample_data(physeq.f)) #just checking it worked
head(tax_table(physeq.f)) #just checking it worked
physeq.f.ra <- transform_sample_counts(physeq.f, function(x) x*100/sum(x)) #transform data from raw abundance to relative abundance
physeq.f.ra.ord <- tax_glom(physeq.f.ra, "Class",NArm=FALSE) #merge taxa on the class level, so that there's only 1 value for each Class CHANGE HERE IF YOU WANT A DIFFERENT TAXONOMIC LEVEL
propData <- as.data.frame((otu_table(physeq.f.ra.ord))) #make otu table a dataframe
plotDF1 <- propData %>% #within the propData variable
rownames_to_column(var="taxa") %>%
melt() %>%
magrittr::set_names(c("sample", "taxa", "relab"))
head(plotDF1)#just checking it worked
taxonomy.2 <- tax_table(physeq.f) %>%
as.data.frame() %>%
rownames_to_column(var="taxa")
head(taxonomy.2)#just checking it worked
head(plotDF1)#just checking it worked
plotDF1 <- left_join(plotDF1, taxonomy.2, by="taxa") %>% select(taxa, sample, relab, Class) #combine dataframes merging by taxa, with the columns listed in select. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
head(plotDF1)#just checking it worked
length(levels(factor(plotDF$Class))) #check how many classes there are
mycolors <- c("black","red","orange","yellow","green","blue","magenta","darkorchid4") #make a list of colors the same length as the number of classes
names(mycolors)<-levels(factor(plotDF$Class)) #set the colors to an associated taxonomic rank. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
mycolors #confirm it worked
sampdata<-data.frame(sample_data(physeq.f)) #make dataframe of the sample data
metadata.2 <- sampdata %>%
rownames_to_column(var="sample")
metadata.2
plotDF1 <- left_join(plotDF1, metadata.2, by="sample") #combine plotDF1 and metadata.2 by sample name
head(plotDF1) #just checking it worked
length(levels(factor(plotDF1$Class))) #check how many classes there are. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
plotDF1$Class<-factor(plotDF1$Class) #make class a factor. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
plotDF1$sample<-factor(plotDF1$sample) #make sample a factor
plotDF1$Site<-factor(plotDF1$Region) #make Region a factor
ggplot(plotDF1, aes(x=plotDF1$sample, relab, fill=Class)) + #make a plot with genotype/sample name on the x-axis, relative abundance on the y-axis, and color filled by Class. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
geom_bar(stat="identity", position = "stack") + #make it a barplot with classes stacked on top of each other
theme(axis.text.x = element_text(angle = 90,size = 10)) + #set x-axis labels to be oriented vertically, and set the size of the text to 10
scale_fill_manual(values = mycolors,limits = levels(plotDF$Class)) + #set the colors being filled in by class to the mycolors variable made earlier
facet_grid(~Region,space="free_x",scales="free_x",drop=TRUE) + #facet wrap (separate out) by Region
theme(legend.title = element_text(size = 8),legend.text = element_text(size = 6),legend.position = "bottom") #set legent title size to 8 and legend text size to 6
physeq.f <- filter_taxa(ps, function(x) sum(x >= 100) > (0.01*length(x)), prune = TRUE) #filter out super small numbers
physeq.f #check it worked
head(sample_data(physeq.f)) #just checking it worked
head(tax_table(physeq.f)) #just checking it worked
physeq.f.ra <- transform_sample_counts(physeq.f, function(x) x*100/sum(x)) #transform data from raw abundance to relative abundance
physeq.f.ra.ord <- tax_glom(physeq.f.ra, "Class",NArm=FALSE) #merge taxa on the class level, so that there's only 1 value for each Class CHANGE HERE IF YOU WANT A DIFFERENT TAXONOMIC LEVEL
propData <- as.data.frame((otu_table(physeq.f.ra.ord))) #make otu table a dataframe
plotDF1 <- propData %>% #within the propData variable
rownames_to_column(var="taxa") %>%
melt() %>%
magrittr::set_names(c("sample", "taxa", "relab"))
head(plotDF1)#just checking it worked
taxonomy.2 <- tax_table(physeq.f) %>%
as.data.frame() %>%
rownames_to_column(var="taxa")
head(taxonomy.2)#just checking it worked
head(plotDF1)#just checking it worked
plotDF1 <- left_join(plotDF1, taxonomy.2, by="taxa") %>% select(taxa, sample, relab, Class) #combine dataframes merging by taxa, with the columns listed in select. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
head(plotDF1)#just checking it worked
length(levels(factor(plotDF$Class))) #check how many classes there are
mycolors <- c("black","red","orange","yellow","green","blue","magenta","darkorchid4") #make a list of colors the same length as the number of classes
names(mycolors)<-levels(factor(plotDF$Class)) #set the colors to an associated taxonomic rank. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
mycolors #confirm it worked
sampdata<-data.frame(sample_data(physeq.f)) #make dataframe of the sample data
metadata.2 <- sampdata %>%
rownames_to_column(var="sample")
metadata.2
plotDF1 <- left_join(plotDF1, metadata.2, by="sample") #combine plotDF1 and metadata.2 by sample name
head(plotDF1) #just checking it worked
length(levels(factor(plotDF1$Class))) #check how many classes there are. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
plotDF1$Class<-factor(plotDF1$Class) #make class a factor. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
plotDF1$sample<-factor(plotDF1$sample) #make sample a factor
plotDF1$Site<-factor(plotDF1$Region) #make Region a factor
ggplot(plotDF1, aes(x=plotDF1$sample, relab, fill=Class)) + #make a plot with genotype/sample name on the x-axis, relative abundance on the y-axis, and color filled by Class. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
geom_bar(stat="identity", position = "stack") + #make it a barplot with classes stacked on top of each other
theme(axis.text.x = element_text(angle = 90,size = 8)) + #set x-axis labels to be oriented vertically, and set the size of the text to 10
scale_fill_manual(values = mycolors,limits = levels(plotDF$Class)) + #set the colors being filled in by class to the mycolors variable made earlier
facet_grid(~Region,space="free_x",scales="free_x",drop=TRUE) + #facet wrap (separate out) by Region
theme(legend.title = element_text(size = 8),legend.text = element_text(size = 6),legend.position = "bottom") #set legent title size to 8 and legend text size to 6
physeq.f <- filter_taxa(ps, function(x) sum(x >= 100) > (0.01*length(x)), prune = TRUE) #filter out super small numbers
physeq.f #check it worked
head(sample_data(physeq.f)) #just checking it worked
head(tax_table(physeq.f)) #just checking it worked
physeq.f.ra <- transform_sample_counts(physeq.f, function(x) x*100/sum(x)) #transform data from raw abundance to relative abundance
physeq.f.ra.ord <- tax_glom(physeq.f.ra, "Class",NArm=FALSE) #merge taxa on the class level, so that there's only 1 value for each Class CHANGE HERE IF YOU WANT A DIFFERENT TAXONOMIC LEVEL
propData <- as.data.frame((otu_table(physeq.f.ra.ord))) #make otu table a dataframe
plotDF1 <- propData %>% #within the propData variable
rownames_to_column(var="taxa") %>%
melt() %>%
magrittr::set_names(c("sample", "taxa", "relab"))
head(plotDF1)#just checking it worked
taxonomy.2 <- tax_table(physeq.f) %>%
as.data.frame() %>%
rownames_to_column(var="taxa")
head(taxonomy.2)#just checking it worked
head(plotDF1)#just checking it worked
plotDF1 <- left_join(plotDF1, taxonomy.2, by="taxa") %>% select(taxa, sample, relab, Class) #combine dataframes merging by taxa, with the columns listed in select. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
head(plotDF1)#just checking it worked
length(levels(factor(plotDF$Class))) #check how many classes there are
mycolors <- c("black","red","orange","yellow","green","blue","magenta","darkorchid4") #make a list of colors the same length as the number of classes
names(mycolors)<-levels(factor(plotDF$Class)) #set the colors to an associated taxonomic rank. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
mycolors #confirm it worked
sampdata<-data.frame(sample_data(physeq.f)) #make dataframe of the sample data
metadata.2 <- sampdata %>%
rownames_to_column(var="sample")
metadata.2
plotDF1 <- left_join(plotDF1, metadata.2, by="sample") #combine plotDF1 and metadata.2 by sample name
head(plotDF1) #just checking it worked
length(levels(factor(plotDF1$Class))) #check how many classes there are. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
plotDF1$Class<-factor(plotDF1$Class) #make class a factor. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
plotDF1$sample<-factor(plotDF1$sample) #make sample a factor
plotDF1$Site<-factor(plotDF1$Region) #make Region a factor
ggplot(plotDF1, aes(x=plotDF1$sample, relab, fill=Class)) + #make a plot with genotype/sample name on the x-axis, relative abundance on the y-axis, and color filled by Class. ALSO CHANGE CLASS HERE IF YOU WANT A DIFFERENT TAXONOMIC RANK
geom_bar(stat="identity", position = "stack") + #make it a barplot with classes stacked on top of each other
theme(axis.text.x = element_text(angle = 90,size = 6.5)) + #set x-axis labels to be oriented vertically, and set the size of the text to 10
scale_fill_manual(values = mycolors,limits = levels(plotDF$Class)) + #set the colors being filled in by class to the mycolors variable made earlier
facet_grid(~Region,space="free_x",scales="free_x",drop=TRUE) + #facet wrap (separate out) by Region
theme(legend.title = element_text(size = 8),legend.text = element_text(size = 6),legend.position = "bottom") #set legent title size to 8 and legend text size to 6
